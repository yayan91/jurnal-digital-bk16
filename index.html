<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jurnal Digital BK</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['"Plus Jakarta Sans"', 'sans-serif'] },
                    colors: { 
                        brand: { 50:'#f0f9ff', 100:'#e0f2fe', 500:'#0ea5e9', 600:'#0284c7', 700:'#0369a1', 900:'#0c4a6e' },
                        slate: { 850: '#1e293b' } 
                    },
                    boxShadow: {
                        'soft': '0 4px 20px -2px rgba(0, 0, 0, 0.05)',
                        'glow': '0 0 15px rgba(14, 165, 233, 0.3)'
                    }
                }
            }
        }
    </script>

    <style>
        /* BASE STYLES */
        body { background-color: #f1f5f9; color: #334155; -webkit-font-smoothing: antialiased; }
        .hidden { display: none !important; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        /* LOADING & ANIMATIONS */
        .loader { position: fixed; inset: 0; background: rgba(255,255,255,0.8); backdrop-filter: blur(8px); z-index: 999; display: flex; justify-content: center; align-items: center; flex-direction: column; }
        .spin { width: 45px; height: 45px; border: 4px solid #e2e8f0; border-top-color: #0284c7; border-radius: 50%; animation: spin 0.8s cubic-bezier(0.4, 0, 0.2, 1) infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        /* MODAL */
        .modal-overlay { position: fixed; inset: 0; background: rgba(15, 23, 42, 0.6); z-index: 100; display: flex; justify-content: center; align-items: center; padding: 15px; backdrop-filter: blur(3px); transition: all 0.3s; }
        .modal-box { background: white; width: 100%; max-width: 750px; max-height: 90vh; overflow-y: auto; border-radius: 16px; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); transform: scale(0.95); opacity: 0; animation: modalIn 0.3s forwards; }
        @keyframes modalIn { to { transform: scale(1); opacity: 1; } }

        /* TAB NAVIGATION */
        .nav-pill { cursor: pointer; padding: 12px 20px; font-weight: 600; color: #64748b; border-radius: 12px; transition: all 0.3s; display: flex; align-items: center; gap: 8px; justify-content: center; white-space: nowrap; }
        .nav-pill:hover { background-color: #f1f5f9; color: #0f172a; }
        .nav-pill.active { background-color: #0284c7; color: white; box-shadow: 0 4px 12px rgba(2, 132, 199, 0.3); }

        /* CARD STYLES */
        .glass-panel { background: white; border: 1px solid #e2e8f0; border-radius: 16px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); }
        .input-field { width: 100%; border: 1px solid #cbd5e1; padding: 10px 14px; border-radius: 10px; transition: 0.2s; font-size: 14px; }
        .input-field:focus { border-color: #0ea5e9; outline: none; ring: 3px; --tw-ring-color: rgba(14, 165, 233, 0.2); }

        /* Stat Cards for Dashboard */
        .stat-card { background: white; border-radius: 16px; padding: 20px; border: 1px solid #e2e8f0; position: relative; overflow: hidden; transition: transform 0.3s; }
        .stat-card:hover { transform: translateY(-3px); box-shadow: 0 10px 20px -5px rgba(0,0,0,0.1); }

        /* --- CSS KHUSUS CETAK PDF --- */
        @media print {
            @page { size: 21.5cm 33cm; margin: 1.5cm; }
            body > * { display: none !important; }
            
            #printArea { 
                display: block !important; 
                position: absolute; 
                top: 0; left: 0; 
                width: 100%; 
                background-color: white;
                z-index: 9999;
                font-family: Arial, Helvetica, sans-serif !important; 
                color: #000;
            }

            .tbl-pdf { width: 100%; border-collapse: collapse; font-size: 11pt; margin-bottom: 20px; }
            .tbl-pdf td { border: 1px solid #000; padding: 6px 10px; vertical-align: top; line-height: 1.4; }
            .col-label { width: 28%; font-weight: bold; background-color: #f0f0f0 !important; -webkit-print-color-adjust: exact; }
            
            .kop-container { display: flex; align-items: center; justify-content: space-between; border-bottom: 3px double black; padding-bottom: 15px; margin-bottom: 25px; }
            .kop-logo { width: 90px; height: 90px; object-fit: contain; mix-blend-mode: multiply; }
            .kop-text { text-align: center; flex: 1; padding: 0 10px; }
            .k1 { font-size: 14pt; font-weight: bold; text-transform: uppercase; }
            .k2 { font-size: 16pt; font-weight: bold; text-transform: uppercase; margin: 2px 0; }
            .k3 { font-size: 10pt; font-style: italic; }

            .ttd-wrap { display: flex; justify-content: space-between; margin-top: 40px; page-break-inside: avoid; }
            .ttd-box { text-align: center; width: 40%; font-size: 11pt; }
            .ttd-nama { font-weight: bold; text-decoration: underline; margin-top: 80px; }
        }
    </style>
</head>
<body class="antialiased selection:bg-brand-100 selection:text-brand-900">

    <div id="loading" class="loader hidden">
        <div class="spin mb-4"></div>
        <p class="font-bold text-slate-600 animate-pulse tracking-wide">Tunggu Yah...</p>
    </div>

    <div id="modalView" class="modal-overlay hidden">
        <div class="modal-box">
            <div class="bg-gradient-to-r from-brand-900 to-brand-700 text-white p-5 flex justify-between items-center sticky top-0 z-10">
                <h3 class="font-bold text-lg flex items-center gap-3"><i class="fa-solid fa-file-contract"></i> Detail Jurnal Lengkap</h3>
                <button onclick="closeModal()" class="w-8 h-8 rounded-full bg-white/10 hover:bg-white/30 flex items-center justify-center transition"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <div class="p-6 md:p-8 space-y-6" id="modalContent"></div>
            <div class="bg-slate-50 p-5 text-right border-t">
                <button onclick="closeModal()" class="bg-white border border-slate-300 text-slate-700 px-6 py-2.5 rounded-lg text-sm font-bold hover:bg-slate-100 shadow-sm transition">Tutup Detail</button>
            </div>
        </div>
    </div>

    <div id="pageLogin" class="min-h-screen flex items-center justify-center p-4 bg-[url('https://source.unsplash.com/random/1920x1080/?office,desk')] bg-cover bg-center">
        <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm"></div>
        <div class="bg-white/90 backdrop-blur-xl p-8 rounded-2xl shadow-2xl w-full max-w-sm border border-white/50 relative z-10 transform hover:scale-[1.01] transition duration-500">
            
            <button onclick="showAppInfo()" class="absolute top-4 right-4 text-slate-400 hover:text-brand-600 transition" title="Informasi Aplikasi">
                <i class="fa-solid fa-circle-info text-2xl"></i>
            </button>

            <div class="text-center mb-8">
                <img src="https://drive.google.com/thumbnail?id=1Z6g-sCdw-k7W8dnw12NeagPkroLlmk-L&sz=w250" class="w-24 h-24 mx-auto mb-4 object-contain drop-shadow-lg filter hover:brightness-110 transition mix-blend-multiply" alt="Logo Login">
                
                <h2 class="text-2xl font-extrabold text-slate-800 tracking-tight">JURNAL BK</h2>
                <p class="text-xs font-semibold text-brand-600 uppercase tracking-[0.2em] mt-2">UPT SPF SMP NEGERI 16 MAKASSAR</p>
            </div>
            <form onsubmit="doLogin(event)" class="space-y-5">
                <div class="group">
                    <label class="text-[10px] font-bold text-slate-500 ml-1 mb-1 block uppercase">NIP / Username</label>
                    <div class="relative">
                        <i class="fa-solid fa-user absolute left-4 top-3.5 text-slate-400 group-focus-within:text-brand-600 transition"></i>
                        <input id="u" type="text" class="w-full bg-slate-50 border border-slate-200 pl-10 pr-4 py-3 rounded-xl focus:ring-2 focus:ring-brand-500 outline-none transition font-medium text-slate-700" placeholder="Masukkan Username" required>
                    </div>
                </div>
                <div class="group">
                    <label class="text-[10px] font-bold text-slate-500 ml-1 mb-1 block uppercase">Password</label>
                    <div class="relative">
                        <i class="fa-solid fa-lock absolute left-4 top-3.5 text-slate-400 group-focus-within:text-brand-600 transition"></i>
                        <input id="p" type="password" class="w-full bg-slate-50 border border-slate-200 pl-10 pr-4 py-3 rounded-xl focus:ring-2 focus:ring-brand-500 outline-none transition font-medium text-slate-700" placeholder="••••••••" required>
                    </div>
                </div>
                <button class="w-full bg-gradient-to-r from-brand-600 to-brand-700 text-white font-bold py-3.5 rounded-xl shadow-lg shadow-brand-500/30 hover:shadow-brand-500/50 hover:-translate-y-0.5 transition duration-300">
                    MASUK APLIKASI <i class="fa-solid fa-arrow-right-to-bracket ml-2"></i>
                </button>
            </form>
            
            <div class="mt-4 text-center">
                <a href="https://wa.me/6285259259767?text=Halo%20Admin%2C%20saya%20lupa%20username%2Fpassword%20aplikasi%20Jurnal%20BK." target="_blank" class="text-xs text-slate-500 hover:text-brand-600 hover:underline transition flex justify-center items-center gap-1">
                    <i class="fa-brands fa-whatsapp text-green-500"></i> Lupa Username/Password? Hubungi Admin
                </a>
            </div>

            <div class="mt-6 pt-6 border-t border-slate-200 text-center">
                <p class="text-[10px] text-slate-400">Developed by <span class="font-bold text-slate-600">Muhammad Hasratul</span></p>
            </div>
        </div>
    </div>

    <div id="pageMain" class="hidden min-h-screen flex flex-col">
        
        <header class="bg-white/80 backdrop-blur-lg sticky top-0 z-40 border-b border-slate-200 shadow-sm">
            <div class="max-w-6xl mx-auto px-4 py-3">
                <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                    <div class="flex items-center gap-4 w-full md:w-auto">
                        <div class="bg-gradient-to-br from-brand-500 to-brand-700 w-12 h-12 rounded-lg flex items-center justify-center text-white shadow-lg shadow-brand-500/30 shrink-0">
                            <i class="fa-solid fa-graduation-cap text-xl"></i>
                        </div>
                        <div>
                            <div class="text-[10px] font-bold text-brand-600 uppercase tracking-wide" id="headerDate">...</div>
                            <div class="font-bold text-lg text-slate-800 leading-tight" id="dSekolah">Loading...</div>
                            <div class="text-xs font-semibold text-slate-500 flex items-center gap-1 mt-1">
                                <i class="fa-solid fa-user-tie text-brand-500"></i>
                                <span id="headerNamaGuru">...</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex items-center gap-3 w-full md:w-auto justify-end">
                        <button onclick="logout()" class="text-xs bg-red-50 text-red-600 border border-red-100 px-4 py-2.5 rounded-full hover:bg-red-600 hover:text-white font-bold transition flex items-center gap-2 shadow-sm">
                            <i class="fa-solid fa-power-off"></i> Keluar
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <div class="bg-white border-b border-slate-200 sticky top-[80px] md:top-[74px] z-30 shadow-sm">
            <div class="max-w-6xl mx-auto px-4 py-2 flex gap-2 overflow-x-auto no-scrollbar">
                <div onclick="switchTab('dashboard')" id="tabDash" class="nav-pill active flex-1 md:flex-none md:w-36">
                    <i class="fa-solid fa-chart-pie"></i> DASHBOARD
                </div>
                <div onclick="switchTab('input')" id="tabInput" class="nav-pill flex-1 md:flex-none md:w-36">
                    <i class="fa-regular fa-pen-to-square"></i> INPUT JURNAL
                </div>
                <div onclick="switchTab('history')" id="tabHistory" class="nav-pill flex-1 md:flex-none md:w-36">
                    <i class="fa-solid fa-clock-rotate-left"></i> RIWAYAT
                </div>
                <div onclick="switchTab('profile')" id="tabProfile" class="nav-pill flex-1 md:flex-none md:w-36">
                    <i class="fa-solid fa-id-card"></i> INFO GURU
                </div>
            </div>
        </div>

        <div class="max-w-6xl mx-auto w-full px-4 py-8 flex-grow">
            
            <div id="viewDashboard" class="animate-fade-in-up">
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-slate-800">Ringkasan Kinerja</h2>
                    <p class="text-slate-500 text-sm">Statistik layanan Bimbingan dan Konseling Anda.</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
                    <div class="stat-card border-l-4 border-l-brand-500">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-xs font-bold text-slate-400 uppercase">Total Jurnal</p>
                                <h3 class="text-3xl font-bold text-slate-800 mt-1" id="dashTotal">0</h3>
                            </div>
                            <div class="bg-brand-50 text-brand-600 p-2 rounded-lg"><i class="fa-solid fa-book"></i></div>
                        </div>
                    </div>
                    <div class="stat-card border-l-4 border-l-green-500">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-xs font-bold text-slate-400 uppercase">Total Layanan</p>
                                <h3 class="text-3xl font-bold text-slate-800 mt-1" id="dashLayanan">0</h3>
                            </div>
                            <div class="bg-green-50 text-green-600 p-2 rounded-lg"><i class="fa-solid fa-users"></i></div>
                        </div>
                        <p class="text-[10px] text-green-600 mt-2 font-bold"><i class="fa-solid fa-arrow-up"></i> Siswa Terlayani</p>
                    </div>
                    <div class="stat-card border-l-4 border-l-yellow-500">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-xs font-bold text-slate-400 uppercase">Bidang Dominan</p>
                                <h3 class="text-lg font-bold text-slate-800 mt-1 truncate" id="dashBidang">-</h3>
                            </div>
                            <div class="bg-yellow-50 text-yellow-600 p-2 rounded-lg"><i class="fa-solid fa-chart-simple"></i></div>
                        </div>
                    </div>
                    <div class="stat-card border-l-4 border-l-purple-500">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-xs font-bold text-slate-400 uppercase">Status Sistem</p>
                                <h3 class="text-lg font-bold text-slate-800 mt-1">ONLINE</h3>
                            </div>
                            <div class="bg-purple-50 text-purple-600 p-2 rounded-lg"><i class="fa-solid fa-wifi"></i></div>
                        </div>
                        <p class="text-[10px] text-slate-400 mt-2">Versi 2.0 (Pro)</p>
                    </div>
                </div>

                <div class="bg-gradient-to-r from-brand-600 to-brand-800 rounded-2xl p-6 md:p-8 text-white relative overflow-hidden shadow-xl mb-8">
                    <div class="absolute right-0 top-0 h-full w-1/3 bg-white/10 skew-x-12 translate-x-12"></div>
                    <div class="relative z-10">
                        <h3 class="text-xl font-bold mb-2">Selamat Datang di Jurnal Profesional!</h3>
                        <p class="text-brand-100 text-sm max-w-xl leading-relaxed">Kelola administrasi BK dengan lebih mudah, rapi, dan akuntabel. Pastikan Anda mengisi jurnal segera setelah layanan diberikan agar data selalu mutakhir.</p>
                        <button onclick="switchTab('input')" class="mt-4 bg-white text-brand-700 px-5 py-2 rounded-lg font-bold text-sm hover:bg-brand-50 transition shadow-lg">
                            <i class="fa-solid fa-plus mr-1"></i> Input Jurnal Baru
                        </button>
                    </div>
                </div>

                <div class="glass-panel p-6">
                    <h3 class="font-bold text-slate-700 mb-4 flex items-center gap-2">
                        <i class="fa-solid fa-clock-rotate-left text-brand-500"></i> Aktivitas Terakhir
                    </h3>
                    <div id="dashboardRecentList" class="space-y-3">
                        <div class="text-center py-4 text-slate-400 text-sm italic">Belum ada data dimuat. Silakan klik menu "Riwayat" untuk memuat data.</div>
                    </div>
                </div>
            </div>

            <div id="viewProfile" class="hidden animate-fade-in-up">
                <div class="max-w-2xl mx-auto">
                    <div class="bg-white rounded-2xl shadow-xl overflow-hidden border border-slate-200">
                        <div class="h-32 bg-gradient-to-r from-brand-600 to-brand-800 relative">
                            <div class="absolute bottom-0 left-0 w-full h-1/2 bg-gradient-to-t from-black/20 to-transparent"></div>
                        </div>
                        <div class="px-8 pb-8 relative">
                            <div class="w-24 h-24 bg-white p-1 rounded-full absolute -top-12 left-8 shadow-lg">
                                <div class="w-full h-full bg-slate-100 rounded-full flex items-center justify-center text-slate-300 text-4xl overflow-hidden">
                                    <i class="fa-solid fa-user"></i>
                                </div>
                            </div>
                            
                            <div class="pt-16">
                                <h2 class="text-2xl font-bold text-slate-800" id="profNama">Nama Guru</h2>
                                <p class="text-brand-600 font-semibold" id="profSekolah">Nama Sekolah</p>
                                
                                <div class="mt-6 space-y-4">
                                    <div class="flex items-center gap-4 p-3 rounded-lg bg-slate-50 border border-slate-100">
                                        <div class="w-10 h-10 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center"><i class="fa-solid fa-id-badge"></i></div>
                                        <div>
                                            <p class="text-[10px] font-bold text-slate-400 uppercase">NIP / NI P3K</p>
                                            <p class="font-bold text-slate-700" id="profNip">-</p>
                                        </div>
                                    </div>
                                    <div class="flex items-center gap-4 p-3 rounded-lg bg-slate-50 border border-slate-100">
                                        <div class="w-10 h-10 rounded-full bg-green-100 text-green-600 flex items-center justify-center"><i class="fa-solid fa-map-location-dot"></i></div>
                                        <div>
                                            <p class="text-[10px] font-bold text-slate-400 uppercase">Alamat Domisili</p>
                                            <p class="font-bold text-slate-700" id="profAlamat">-</p>
                                        </div>
                                    </div>
                                    <div class="flex items-center gap-4 p-3 rounded-lg bg-slate-50 border border-slate-100">
                                        <div class="w-10 h-10 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center"><i class="fa-solid fa-school"></i></div>
                                        <div>
                                            <p class="text-[10px] font-bold text-slate-400 uppercase">Instansi</p>
                                            <p class="font-bold text-slate-700" id="profInstansi">-</p>
                                        </div>
                                    </div>
                                </div>

                                <div class="mt-8 pt-6 border-t border-slate-100 text-center">
                                    <p class="text-xs text-slate-400">Data ini diambil otomatis dari database kepegawaian aplikasi.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="viewInput" class="hidden animate-fade-in-up">
                <div class="glass-panel p-6 md:p-8">
                    <div class="flex justify-between items-center mb-8 pb-4 border-b border-slate-100">
                        <div>
                            <h3 class="font-bold text-2xl text-slate-800" id="formTitle">Formulir Kegiatan</h3>
                            <p class="text-sm text-slate-400 mt-1">Isi data layanan bimbingan konseling dengan lengkap</p>
                        </div>
                        <button onclick="resetForm()" id="btnCancel" class="hidden text-red-500 text-xs font-bold uppercase border border-red-200 bg-red-50 px-4 py-2 rounded-lg hover:bg-red-600 hover:text-white transition">
                            <i class="fa-solid fa-ban mr-1"></i> Batal Edit
                        </button>
                    </div>

                    <form id="formJurnal" onsubmit="submitData(event)" class="space-y-6">
                        <input type="hidden" name="id" id="inputId">
                        
                        <div class="grid md:grid-cols-12 gap-6">
                            <div class="md:col-span-4">
                                <label class="text-xs font-bold text-slate-500 block mb-2 uppercase">Tanggal Kegiatan</label>
                                <input type="date" name="tanggal" required class="input-field bg-brand-50/50 border-brand-200">
                            </div>
                            <div class="md:col-span-4">
                                <label class="text-xs font-bold text-slate-500 block mb-2 uppercase">Jam Ke-</label>
                                <div class="relative">
                                    <i class="fa-regular fa-clock absolute left-3 top-3 text-slate-400"></i>
                                    <input type="text" name="jam" placeholder="Cth: 1-2" class="input-field pl-9">
                                </div>
                            </div>
                            <div class="md:col-span-4">
                                <label class="text-xs font-bold text-slate-500 block mb-2 uppercase">Durasi (Menit)</label>
                                <input type="text" name="waktu" placeholder="Cth: 40 Menit" class="input-field">
                            </div>
                        </div>

                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <label class="text-xs font-bold text-slate-500 block mb-2 uppercase">Sasaran Layanan</label>
                                <div class="relative">
                                    <i class="fa-solid fa-users absolute left-3 top-3 text-slate-400"></i>
                                    <input type="text" name="sasaran" placeholder="Siswa / Guru / Ortu" required class="input-field pl-9">
                                </div>
                            </div>
                            <div>
                                <label class="text-xs font-bold text-slate-500 block mb-2 uppercase">Kelas / Status</label>
                                <input type="text" name="kelas" placeholder="Cth: IX A" class="input-field">
                            </div>
                        </div>

                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <label class="text-xs font-bold text-slate-500 block mb-2 uppercase">Bidang Bimbingan</label>
                                <select name="bidang" class="input-field bg-white">
                                    <option>Pribadi</option>
                                    <option>Sosial</option>
                                    <option>Belajar</option>
                                    <option>Karir</option>
                                </select>
                            </div>
                            <div>
                                <label class="text-xs font-bold text-slate-500 block mb-2 uppercase">Jenis Layanan</label>
                                <input type="text" name="jenis" list="ls" class="input-field" placeholder="Pilih atau Ketik...">
                                <datalist id="ls"><option value="Konseling Individu"><option value="Bimbingan Kelompok"><option value="Bimbingan Klasikal"><option value="Konsultasi"><option value="Alih Tangan Kasus"></datalist>
                            </div>
                        </div>

                        <div>
                            <label class="text-xs font-bold text-slate-500 block mb-2 uppercase">Topik / Masalah</label>
                            <input type="text" name="topik" class="input-field font-semibold text-slate-700 bg-slate-50" placeholder="Inti kegiatan layanan...">
                        </div>

                        <div class="grid md:grid-cols-2 gap-6">
                            <div><label class="text-xs font-bold text-slate-500 block mb-2 uppercase">Tujuan</label><textarea name="tujuan" rows="2" class="input-field"></textarea></div>
                            <div><label class="text-xs font-bold text-slate-500 block mb-2 uppercase">Media / Alat</label><input type="text" name="media" class="input-field"></div>
                        </div>

                        <div><label class="text-xs font-bold text-slate-500 block mb-2 uppercase">Ringkasan Proses</label><textarea name="ringkasan" rows="3" class="input-field"></textarea></div>

                        <div class="bg-slate-50 p-6 rounded-xl border border-slate-200 grid md:grid-cols-3 gap-5">
                            <div><label class="text-[10px] font-bold text-slate-400 block mb-2 uppercase">Evaluasi</label><textarea name="evaluasi" rows="2" class="input-field bg-white text-sm"></textarea></div>
                            <div><label class="text-[10px] font-bold text-slate-400 block mb-2 uppercase">Tindak Lanjut</label><textarea name="tindaklanjut" rows="2" class="input-field bg-white text-sm"></textarea></div>
                            <div><label class="text-[10px] font-bold text-slate-400 block mb-2 uppercase">Catatan Khusus</label><textarea name="catatan" rows="2" class="input-field bg-white text-sm"></textarea></div>
                        </div>

                        <button id="btnSimpan" class="w-full bg-brand-600 text-white font-bold py-4 rounded-xl shadow-lg shadow-brand-500/30 hover:bg-brand-700 hover:-translate-y-1 transition transform duration-200 flex justify-center items-center gap-2 text-base">
                            <i class="fa-solid fa-floppy-disk"></i> SIMPAN JURNAL KEGIATAN
                        </button>
                    </form>
                </div>
            </div>

            <div id="viewHistory" class="hidden animate-fade-in-up">
                
                <div class="glass-panel p-4 mb-6 flex flex-col md:flex-row justify-between items-center gap-4">
                    <div class="flex items-center gap-3 w-full md:w-auto">
                        <span class="text-sm font-bold text-slate-600">Tampilkan:</span>
                        <select id="rowsPerPage" onchange="changeRows()" class="border border-slate-300 rounded-lg p-2 text-sm focus:ring-2 focus:ring-brand-500 outline-none">
                            <option value="5">5 Baris</option>
                            <option value="10">10 Baris</option>
                            <option value="20">20 Baris</option>
                            <option value="1000">Semua</option>
                        </select>
                    </div>

                    <div class="w-full md:w-1/3 relative">
                         <i class="fa-solid fa-search absolute left-3 top-3 text-slate-400 text-sm"></i>
                         <input type="text" id="searchInput" onkeyup="filterData()" placeholder="Cari topik, sasaran..." class="w-full border border-slate-300 rounded-lg pl-9 pr-4 py-2 text-sm focus:ring-2 focus:ring-brand-500 outline-none">
                    </div>

                    <button onclick="loadHistory()" class="bg-slate-100 text-slate-600 px-4 py-2 rounded-lg text-sm font-bold hover:bg-slate-200 transition">
                        <i class="fa-solid fa-arrows-rotate mr-1"></i> Refresh
                    </button>
                </div>

                <div id="listContainer" class="space-y-4"></div>

                <div id="paginationControls" class="flex justify-center items-center gap-4 mt-8">
                </div>
            </div>

        </div>

        <footer class="text-center text-xs text-slate-400 py-8 mt-auto border-t bg-white">
            <p class="mb-1">Platform Aplikasi Jurnal Bimbingan dan Konseling</p>
            <p class="font-bold text-slate-600">Pengembang: Muhammad Hasratul - Mappaguru Online &copy; 2026</p>
        </footer>
    </div>

    <div id="printArea" class="hidden">
        <div class="kop-container">
            <img src="https://drive.google.com/thumbnail?id=1paUgNvlMQWsPkT3ccnQ16umwrOxZ7y_i&sz=w250" class="kop-logo" alt="Logo Kiri">
            
            <div class="kop-text">
                <div class="k1" id="p_pem"></div>
                <div class="k1" id="p_ins"></div>
                <div class="k2" id="p_sek"></div>
                <div class="k2" style="font-size:12pt; margin-top:-5px;">BIMBINGAN DAN KONSELING</div>
                <div class="k3" id="p_almt"></div>
            </div>
            
            <img src="https://drive.google.com/thumbnail?id=1MGchP5nPXQGHbkCjwUEdck8xN-c4Whyg&sz=w250" class="kop-logo" alt="Logo Kanan">
        </div>

        <div class="judul-pdf" id="p_judul" style="text-align:center; font-weight:bold; text-decoration:underline; font-size:12pt; margin-top:15px; text-transform:uppercase;">LAPORAN JURNAL LAYANAN BIMBINGAN DAN KONSELING</div>
        <div class="info-ta" style="text-align:center; font-size:11pt; font-weight:bold; margin-bottom:20px;">
            Tahun Ajaran: <span id="p_ta"></span> | Semester: <span id="p_sem"></span>
        </div>

        <table class="tbl-pdf">
            <tr><td class="col-label">Hari, Tanggal</td><td id="t1"></td></tr>
            <tr><td class="col-label">Jam / Waktu</td><td><span id="t2"></span> / <span id="t3"></span></td></tr>
            <tr><td class="col-label">Sasaran (Kelas)</td><td><span id="t4"></span> (<span id="t5"></span>)</td></tr>
            <tr><td class="col-label">Bidang & Jenis</td><td><span id="t6"></span> - <span id="t7"></span></td></tr>
            <tr><td class="col-label">Topik / Masalah</td><td id="t8"></td></tr>
            <tr><td class="col-label">Tujuan Layanan</td><td id="t9"></td></tr>
            <tr><td class="col-label">Media / Alat</td><td id="t10"></td></tr>
            <tr><td class="col-label">Ringkasan Proses</td><td id="t11" style="min-height: 80px;"></td></tr>
            <tr><td class="col-label">Hasil Evaluasi</td><td id="t12"></td></tr>
            <tr><td class="col-label">Tindak Lanjut</td><td id="t13"></td></tr>
            <tr><td class="col-label">Catatan Khusus</td><td id="t14"></td></tr>
        </table>

        <div class="ttd-wrap">
            <div class="ttd-box">
                <p>Mengetahui,<br>Kepala Sekolah</p>
                <div class="ttd-nama" id="pkep"></div>
                <p>NIP. <span id="pnipkep"></span></p>
            </div>
            <div class="ttd-box">
                <p>Makassar, <span id="ptglttd"></span><br>Guru BK</p>
                <div class="ttd-nama" id="pguru"></div>
                <p>NIP. <span id="pnipguru"></span></p>
            </div>
        </div>
    </div>

    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycbxMbp7LlrCgbwoAIB_xCtrHCTpRI9s2zKT7BhH7E-d2qOnP2O8AzO4vxjl-EsaDMTwGog/exec"; 

        let user=null, conf=null, historyData=[];
        
        // --- VARIABEL PAGINASI ---
        let currentPage = 1;
        let rowsPerPage = 5;
        let filteredData = [];

        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        document.getElementById('headerDate').innerText = new Date().toLocaleDateString('id-ID', options).toUpperCase();

        function switchTab(t){
            // Sembunyikan semua view
            document.getElementById('viewDashboard').classList.add('hidden');
            document.getElementById('viewInput').classList.add('hidden');
            document.getElementById('viewHistory').classList.add('hidden');
            document.getElementById('viewProfile').classList.add('hidden');

            // Reset tombol navigasi
            document.querySelectorAll('.nav-pill').forEach(el => el.classList.remove('active'));

            // Aktifkan tab yang dipilih
            if(t == 'dashboard'){
                document.getElementById('viewDashboard').classList.remove('hidden');
                document.getElementById('tabDash').classList.add('active');
                updateDashboard(); // Hitung ulang statistik
                if(historyData.length == 0) loadHistory(true); // Load silent background
            }
            else if(t == 'input'){
                document.getElementById('viewInput').classList.remove('hidden');
                document.getElementById('tabInput').classList.add('active');
            } 
            else if(t == 'history'){
                document.getElementById('viewHistory').classList.remove('hidden');
                document.getElementById('tabHistory').classList.add('active');
                if(historyData.length == 0) loadHistory();
            } 
            else if(t == 'profile'){
                document.getElementById('viewProfile').classList.remove('hidden');
                document.getElementById('tabProfile').classList.add('active');
            }
        }

        // --- FUNGSI UPDATE DASHBOARD ---
        function updateDashboard(){
            // Hitung Total Jurnal
            document.getElementById('dashTotal').innerText = historyData.length;

            if(historyData.length > 0){
                // Hitung Statistik Sederhana
                let bidangCount = {};
                historyData.forEach(d => {
                    bidangCount[d.bidang] = (bidangCount[d.bidang] || 0) + 1;
                });
                
                // Cari Bidang Dominan
                let dominant = Object.keys(bidangCount).reduce((a, b) => bidangCount[a] > bidangCount[b] ? a : b);
                document.getElementById('dashBidang').innerText = dominant;
                document.getElementById('dashLayanan').innerText = historyData.length; // Asumsi 1 jurnal = 1 layanan

                // Tampilkan List Kecil (3 Terakhir)
                let recentHtml = '';
                let top3 = historyData.slice(0, 3);
                top3.forEach(d => {
                    recentHtml += `
                        <div class="flex items-center justify-between p-3 rounded-lg bg-slate-50 border border-slate-100 hover:bg-white hover:shadow-sm transition cursor-pointer">
                            <div>
                                <div class="font-bold text-xs text-slate-800">${d.topik}</div>
                                <div class="text-[10px] text-slate-500">${d.tanggal.substring(0,10)} - ${d.sasaran}</div>
                            </div>
                            <span class="text-[10px] bg-brand-100 text-brand-600 px-2 py-1 rounded font-bold">${d.bidang}</span>
                        </div>
                    `;
                });
                document.getElementById('dashboardRecentList').innerHTML = recentHtml;

            } else {
                document.getElementById('dashBidang').innerText = "-";
                document.getElementById('dashboardRecentList').innerHTML = `<div class="text-center py-4 text-slate-400 text-sm italic">Belum ada data.</div>`;
            }
        }

        function showAppInfo() {
            Swal.fire({
                title: 'Panduan Aplikasi',
                html: `<div class="text-left text-sm text-slate-600">Gunakan menu dashboard untuk melihat ringkasan, input untuk mengisi data, riwayat untuk laporan, dan info guru untuk melihat profil Anda.</div>`,
                icon: 'info',
                confirmButtonColor: '#0ea5e9'
            });
        }

        async function doLogin(e){
            e.preventDefault(); loading(true);
            try {
                let u=document.getElementById('u').value, p=document.getElementById('p').value;
                let r=await fetch(`${API_URL}?action=login&u=${u}&p=${p}`).then(x=>x.json());
                if(r.status=='sukses'){
                    user=r;
                    conf=await fetch(`${API_URL}?action=getConfig`).then(x=>x.json());
                    
                    document.getElementById('pageLogin').classList.add('hidden');
                    document.getElementById('pageMain').classList.remove('hidden');
                    
                    // ISI DATA HEADER DAN INFO GURU
                    document.getElementById('dSekolah').innerText=conf.sekolah;
                    
                    // Request #1: Nama Guru di Header
                    document.getElementById('headerNamaGuru').innerText=user.nama; 

                    // Isi Data Profil Tab Info Guru (Request #2)
                    document.getElementById('profNama').innerText = user.nama;
                    document.getElementById('profNip').innerText = user.nip;
                    document.getElementById('profSekolah').innerText = conf.sekolah;
                    document.getElementById('profAlamat').innerText = user.alamat;
                    document.getElementById('profInstansi').innerText = conf.instansi;

                    Swal.fire({
                        icon: 'success',
                        title: 'Selamat Datang!',
                        text: `Halo, ${user.nama}. Sistem siap digunakan.`,
                        timer: 1500,
                        showConfirmButton: false
                    });
                    
                    // Default ke Dashboard (Request #3)
                    switchTab('dashboard');
                    loadHistory(true); // Load data di background agar dashboard terisi

                } else {
                    Swal.fire('Login Gagal', r.message, 'error');
                }
            } catch(e){
                Swal.fire('Error', "Gagal Koneksi ke Server", 'error');
            }
            loading(false);
        }

        async function submitData(e){
            e.preventDefault();
            
            const result = await Swal.fire({
                title: 'Simpan Jurnal?',
                text: "Pastikan data sudah benar sebelum disimpan.",
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#0284c7',
                cancelButtonColor: '#cbd5e1',
                confirmButtonText: 'Ya, Simpan!'
            });

            if (!result.isConfirmed) return;

            loading(true);
            let fd = new FormData(document.getElementById('formJurnal'));
            let d = Object.fromEntries(fd.entries());
            d.action="simpan"; d.namaGuru=user.nama; d.nipGuru=user.nip; 
            d.alamatGuru=user.alamat; d.ta=conf.ta; d.semester=conf.semester;

            try {
                await fetch(API_URL, {method:'POST', body:JSON.stringify(d)});
                Swal.fire('Berhasil!', 'Data jurnal telah disimpan.', 'success');
                resetForm();
                loadHistory(); 
            } catch(x){
                Swal.fire('Gagal', 'Terjadi kesalahan saat menyimpan.', 'error');
            }
            loading(false);
        }

        async function loadHistory(silent = false){
            if(!silent) loading(true);
            try {
                let r=await fetch(`${API_URL}?action=getHistory&nip=${user.nip}`).then(x=>x.json());
                historyData = r.data;
                filteredData = historyData; 
                currentPage = 1; 
                
                // Jika sedang di tab riwayat, render tabel
                if(!document.getElementById('viewHistory').classList.contains('hidden')){
                    renderPagination();
                }
                // Jika sedang di dashboard, update chart/angka
                if(!document.getElementById('viewDashboard').classList.contains('hidden')){
                    updateDashboard();
                }

            } catch(e){
                console.error(e);
            }
            if(!silent) loading(false);
        }

        // --- FUNGSI PAGINASI & FILTER ---
        function changeRows() {
            rowsPerPage = parseInt(document.getElementById('rowsPerPage').value);
            currentPage = 1;
            renderPagination();
        }

        function filterData() {
            let k = document.getElementById('searchInput').value.toLowerCase();
            filteredData = historyData.filter(item => 
                item.topik.toLowerCase().includes(k) || 
                item.sasaran.toLowerCase().includes(k) ||
                item.kelas.toLowerCase().includes(k)
            );
            currentPage = 1;
            renderPagination();
        }

        function changePage(delta) {
            let maxPage = Math.ceil(filteredData.length / rowsPerPage);
            let newPage = currentPage + delta;
            if (newPage >= 1 && newPage <= maxPage) {
                currentPage = newPage;
                renderPagination();
            }
        }

        function renderPagination() {
            const listEl = document.getElementById('listContainer');
            const ctrlEl = document.getElementById('paginationControls');
            listEl.innerHTML = "";
            ctrlEl.innerHTML = "";

            if(filteredData.length === 0) {
                listEl.innerHTML = `<div class="text-center p-12 bg-white border border-dashed border-slate-300 rounded-xl text-slate-400">
                    <i class="fa-regular fa-folder-open text-4xl mb-3"></i><br>Tidak ada data ditemukan.</div>`;
                return;
            }

            // Slice Logic
            let start = (currentPage - 1) * rowsPerPage;
            let end = start + rowsPerPage;
            let pageItems = filteredData.slice(start, end);

            // Render Items
            let html = "";
            pageItems.forEach((d, index) => {
                let realIndex = historyData.indexOf(d); 

                html += `
                <div class="glass-panel p-5 hover:shadow-lg transition duration-200 group border-l-4 border-l-brand-500">
                    <div class="flex flex-col md:flex-row justify-between mb-3 gap-2">
                        <div class="flex-1">
                            <h4 class="font-bold text-lg text-slate-800 leading-snug group-hover:text-brand-600 transition">${d.topik}</h4>
                            <div class="flex items-center gap-2 mt-2">
                                <span class="text-[10px] font-bold text-white bg-brand-500 px-2 py-0.5 rounded shadow-sm uppercase tracking-wide">${d.jenis}</span>
                                <span class="text-xs text-slate-500"><i class="fa-solid fa-layer-group text-slate-400 mr-1"></i> ${d.bidang}</span>
                            </div>
                        </div>
                        <div class="text-left md:text-right min-w-[120px]">
                            <div class="text-sm font-bold text-slate-600 bg-slate-100 px-3 py-1 rounded-lg inline-block">
                                <i class="fa-regular fa-calendar mr-2 text-brand-500"></i>${d.tanggal.substring(0,10)}
                            </div>
                            <div class="text-xs text-slate-400 mt-1 pl-1">Jam: ${d.jam} (${d.waktu})</div>
                        </div>
                    </div>
                    
                    <div class="text-sm text-slate-600 mb-4 pl-1 border-t border-slate-100 pt-2 mt-2 flex items-center gap-3">
                        <span><i class="fa-solid fa-user-tag text-slate-400 mr-1"></i> ${d.sasaran}</span>
                        <span class="text-slate-300">|</span>
                        <span><i class="fa-solid fa-chalkboard-user text-slate-400 mr-1"></i> Kelas <b>${d.kelas}</b></span>
                    </div>

                    <div class="grid grid-cols-4 gap-3">
                        <button onclick="viewItem(${realIndex})" class="col-span-1 bg-white border border-slate-200 text-slate-600 py-2 rounded-lg text-xs font-bold hover:bg-brand-50 hover:text-brand-600 hover:border-brand-200 transition flex items-center justify-center gap-2">
                            <i class="fa-regular fa-eye"></i> <span class="hidden md:inline">LIHAT</span>
                        </button>
                        <button onclick="editItem(${realIndex})" class="col-span-1 bg-white border border-slate-200 text-slate-600 py-2 rounded-lg text-xs font-bold hover:bg-yellow-50 hover:text-yellow-600 hover:border-yellow-200 transition flex items-center justify-center gap-2">
                            <i class="fa-regular fa-pen-to-square"></i> <span class="hidden md:inline">UBAH</span>
                        </button>
                        <button onclick="printItem(${realIndex})" class="col-span-1 bg-white border border-slate-200 text-slate-600 py-2 rounded-lg text-xs font-bold hover:bg-green-50 hover:text-green-600 hover:border-green-200 transition flex items-center justify-center gap-2">
                            <i class="fa-solid fa-print"></i> <span class="hidden md:inline">PDF</span>
                        </button>
                        <button onclick="deleteItem('${d.id}')" class="col-span-1 bg-white border border-slate-200 text-slate-600 py-2 rounded-lg text-xs font-bold hover:bg-red-50 hover:text-red-500 hover:border-red-200 transition flex items-center justify-center gap-2">
                            <i class="fa-regular fa-trash-can"></i> <span class="hidden md:inline">HAPUS</span>
                        </button>
                    </div>
                </div>`;
            });
            listEl.innerHTML = html;

            // Render Controls
            let maxPage = Math.ceil(filteredData.length / rowsPerPage);
            ctrlEl.innerHTML = `
                <button onclick="changePage(-1)" ${currentPage===1 ? 'disabled' : ''} class="w-10 h-10 rounded-full flex items-center justify-center border border-slate-300 text-slate-600 hover:bg-brand-500 hover:text-white hover:border-brand-500 disabled:opacity-50 disabled:hover:bg-transparent disabled:hover:text-slate-600 transition">
                    <i class="fa-solid fa-chevron-left"></i>
                </button>
                <span class="text-sm font-bold text-slate-600">Hal ${currentPage} dari ${maxPage}</span>
                <button onclick="changePage(1)" ${currentPage===maxPage ? 'disabled' : ''} class="w-10 h-10 rounded-full flex items-center justify-center border border-slate-300 text-slate-600 hover:bg-brand-500 hover:text-white hover:border-brand-500 disabled:opacity-50 disabled:hover:bg-transparent disabled:hover:text-slate-600 transition">
                    <i class="fa-solid fa-chevron-right"></i>
                </button>
            `;
        }

        function viewItem(i){
            let d=historyData[i];
            let html=`
                <div class="bg-brand-50 p-5 rounded-xl border border-brand-100 grid grid-cols-2 gap-y-4 text-sm relative overflow-hidden">
                    <div class="absolute right-0 top-0 w-24 h-24 bg-brand-200 rounded-full -mr-10 -mt-10 opacity-20"></div>
                    <div><span class="text-[10px] font-bold text-slate-400 block uppercase tracking-wide">Tanggal</span><span class="font-bold text-slate-800 text-base">${d.tanggal.substring(0,10)}</span></div>
                    <div><span class="text-[10px] font-bold text-slate-400 block uppercase tracking-wide">Waktu</span><span class="font-bold text-slate-800 text-base">${d.jam} (${d.waktu})</span></div>
                    <div><span class="text-[10px] font-bold text-slate-400 block uppercase tracking-wide">Sasaran</span><span class="font-bold text-slate-800 text-base">${d.sasaran} (${d.kelas})</span></div>
                    <div><span class="text-[10px] font-bold text-slate-400 block uppercase tracking-wide">Layanan</span><span class="font-bold text-slate-800 text-base">${d.jenis}</span></div>
                    <div class="col-span-2"><span class="text-[10px] font-bold text-slate-400 block uppercase tracking-wide">Bidang Bimbingan</span><span class="font-bold text-brand-600">${d.bidang}</span></div>
                </div>

                <div class="space-y-5">
                    <div>
                        <h4 class="text-xs font-bold text-slate-400 uppercase mb-2 flex items-center gap-2"><i class="fa-solid fa-heading"></i> Topik / Masalah</h4>
                        <div class="p-4 bg-white border border-slate-200 rounded-xl text-slate-700 font-semibold shadow-sm">${d.topik}</div>
                    </div>
                    
                    <div class="grid md:grid-cols-2 gap-5">
                        <div>
                            <h4 class="text-xs font-bold text-slate-400 uppercase mb-2">Tujuan Layanan</h4>
                            <div class="p-4 bg-white border border-slate-200 rounded-xl text-slate-600 text-sm h-full shadow-sm">${d.tujuan || '-'}</div>
                        </div>
                        <div>
                            <h4 class="text-xs font-bold text-slate-400 uppercase mb-2">Media / Alat</h4>
                            <div class="p-4 bg-white border border-slate-200 rounded-xl text-slate-600 text-sm h-full shadow-sm">${d.media || '-'}</div>
                        </div>
                    </div>

                    <div>
                        <h4 class="text-xs font-bold text-slate-400 uppercase mb-2">Ringkasan Proses</h4>
                        <div class="p-4 bg-white border border-slate-200 rounded-xl text-slate-600 text-sm leading-relaxed shadow-sm">${d.ringkasan || '-'}</div>
                    </div>

                    <div class="grid md:grid-cols-3 gap-4">
                         <div class="bg-yellow-50 p-3 rounded-xl border border-yellow-100">
                            <h4 class="text-[10px] font-bold text-yellow-600 uppercase mb-1">Evaluasi</h4>
                            <div class="text-slate-600 text-xs">${d.evaluasi || '-'}</div>
                        </div>
                        <div class="bg-green-50 p-3 rounded-xl border border-green-100">
                            <h4 class="text-[10px] font-bold text-green-600 uppercase mb-1">Tindak Lanjut</h4>
                            <div class="text-slate-600 text-xs">${d.tindaklanjut || '-'}</div>
                        </div>
                        <div class="bg-slate-50 p-3 rounded-xl border border-slate-200">
                            <h4 class="text-[10px] font-bold text-slate-500 uppercase mb-1">Catatan Khusus</h4>
                            <div class="text-slate-600 text-xs">${d.catatan || '-'}</div>
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('modalContent').innerHTML=html;
            document.getElementById('modalView').classList.remove('hidden');
        }
        function closeModal(){document.getElementById('modalView').classList.add('hidden');}

        function editItem(i){
            let d=historyData[i];
            switchTab('input');
            document.getElementById('inputId').value=d.id;
            let f=document.getElementById('formJurnal');
            f.tanggal.value=d.tanggal.substring(0,10); f.jam.value=d.jam; f.waktu.value=d.waktu;
            f.sasaran.value=d.sasaran; f.kelas.value=d.kelas; f.bidang.value=d.bidang; f.jenis.value=d.jenis;
            f.topik.value=d.topik; f.tujuan.value=d.tujuan; f.media.value=d.media;
            f.ringkasan.value=d.ringkasan; f.evaluasi.value=d.evaluasi;
            f.tindaklanjut.value=d.tindaklanjut; f.catatan.value=d.catatan;
            
            document.getElementById('formTitle').innerText="Ubah Data Jurnal";
            document.getElementById('btnSimpan').innerHTML="<i class='fa-solid fa-arrows-rotate'></i> PERBARUI DATA";
            document.getElementById('btnSimpan').classList.remove('bg-brand-600', 'hover:bg-brand-700');
            document.getElementById('btnSimpan').classList.add('bg-orange-500', 'hover:bg-orange-600');
            document.getElementById('btnCancel').classList.remove('hidden');
            window.scrollTo(0,0);
        }

        function resetForm(){
            document.getElementById('formJurnal').reset();
            document.getElementById('inputId').value="";
            document.getElementById('formTitle').innerText="Formulir Kegiatan";
            document.getElementById('btnSimpan').innerHTML="<i class='fa-solid fa-floppy-disk'></i> SIMPAN JURNAL KEGIATAN";
            document.getElementById('btnSimpan').classList.remove('bg-orange-500', 'hover:bg-orange-600');
            document.getElementById('btnSimpan').classList.add('bg-brand-600', 'hover:bg-brand-700');
            document.getElementById('btnCancel').classList.add('hidden');
        }

        async function deleteItem(id){
            const result = await Swal.fire({
                title: 'Hapus Permanen?',
                text: "Data yang dihapus tidak dapat dikembalikan!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#ef4444',
                cancelButtonColor: '#cbd5e1',
                confirmButtonText: 'Ya, Hapus!'
            });

            if(!result.isConfirmed) return;

            loading(true);
            try {
                await fetch(API_URL, {method:'POST', body:JSON.stringify({action:'hapus',id:id})});
                Swal.fire('Terhapus!', 'Data berhasil dihapus.', 'success');
                loadHistory();
            } catch(e){Swal.fire('Gagal', 'Gagal menghapus data.', 'error');}
            loading(false);
        }

        function printItem(i){
            let d=historyData[i];
            document.getElementById('p_pem').innerText=conf.pem;
            document.getElementById('p_ins').innerText=conf.instansi;
            document.getElementById('p_sek').innerText=conf.sekolah;
            document.getElementById('p_almt').innerText=conf.alamat;
            document.getElementById('p_ta').innerText=conf.ta;
            document.getElementById('p_sem').innerText=conf.semester;

            let dateObj = new Date(d.tanggal);
            let options = { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' };
            let formattedDate = dateObj.toLocaleDateString('id-ID', options);

            document.getElementById('t1').innerText=formattedDate; 
            document.getElementById('ptglttd').innerText=formattedDate; 

            document.getElementById('t2').innerText=d.jam; document.getElementById('t3').innerText=d.waktu;
            document.getElementById('t4').innerText=d.sasaran; document.getElementById('t5').innerText=d.kelas;
            document.getElementById('t6').innerText=d.bidang; document.getElementById('t7').innerText=d.jenis;
            document.getElementById('t8').innerText=d.topik; document.getElementById('t9').innerText=d.tujuan;
            document.getElementById('t10').innerText=d.media; document.getElementById('t11').innerText=d.ringkasan;
            document.getElementById('t12').innerText=d.evaluasi; document.getElementById('t13').innerText=d.tindaklanjut;
            document.getElementById('t14').innerText=d.catatan;

            document.getElementById('pkep').innerText=conf.kepsek; document.getElementById('pnipkep').innerText=conf.nip_kepsek;
            document.getElementById('pguru').innerText=user.nama; document.getElementById('pnipguru').innerText=user.nip;
            
            window.print();
        }

        function logout(){
            Swal.fire({
                title: 'Keluar Aplikasi?',
                text: "Anda harus login ulang untuk masuk kembali.",
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#ef4444',
                cancelButtonColor: '#cbd5e1',
                confirmButtonText: 'Ya, Keluar'
            }).then((result) => {
                if (result.isConfirmed) {
                    location.reload();
                }
            });
        }
        
        function loading(x){document.getElementById('loading').classList.toggle('hidden',!x);}
    </script>
</body>
</html>

