<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jurnal Digital BK - Mappaguru Online</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['"Plus Jakarta Sans"', 'sans-serif'] },
                    colors: { brand: { 50:'#eff6ff', 600:'#2563eb', 700:'#1d4ed8', 900:'#1e3a8a' } }
                }
            }
        }
    </script>

    <style>
        /* CSS LAYAR UTAMA */
        body { background-color: #f8fafc; color: #334155; }
        .hidden { display: none !important; }
        
        /* Loading */
        .loader { position: fixed; inset: 0; background: rgba(255,255,255,0.9); z-index: 999; display: flex; justify-content: center; align-items: center; flex-direction: column; backdrop-filter: blur(5px); }
        .spin { width: 50px; height: 50px; border: 4px solid #e2e8f0; border-top-color: #2563eb; border-radius: 50%; animation: s 0.8s ease-in-out infinite; }
        @keyframes s { to { transform: rotate(360deg); } }

        /* Modal & Tabs */
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 100; display: flex; justify-content: center; align-items: center; padding: 10px; backdrop-filter: blur(2px); }
        .modal-box { background: white; width: 100%; max-width: 700px; max-height: 90vh; overflow-y: auto; border-radius: 12px; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); animation: popUp 0.3s cubic-bezier(0.18, 0.89, 0.32, 1.28); }
        @keyframes popUp { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        
        .tab-btn { padding: 12px; cursor: pointer; font-weight: 600; color: #64748b; border-bottom: 3px solid transparent; flex: 1; text-align: center; transition: 0.3s; }
        .tab-btn.active { color: #2563eb; border-bottom-color: #2563eb; background: white; }

        /* --- CSS KHUSUS CETAK PDF (ARIAL & MODERN) --- */
        @media print {
            @page { size: 21.5cm 33cm; margin: 1.5cm; }
            body * { visibility: hidden; }
            #printArea, #printArea * { visibility: visible; }
            #printArea { 
                position: absolute; left: 0; top: 0; width: 100%; 
                font-family: Arial, Helvetica, sans-serif !important; /* Ganti ke Arial */
                color: #000;
            }

            /* Styling Tabel PDF yang Lebih Informatif */
            .tbl-pdf { width: 100%; border-collapse: collapse; font-size: 11pt; margin-bottom: 20px; }
            .tbl-pdf td { 
                border: 1px solid #333; 
                padding: 6px 10px; /* Spasi isi tabel */
                vertical-align: top; 
                line-height: 1.4;
            }
            .col-label { 
                width: 28%; 
                font-weight: bold; 
                background-color: #f0f0f0 !important; /* Warna abu muda biar modern */
                -webkit-print-color-adjust: exact; 
            }
            
            /* Header Kop */
            .kop { text-align: center; border-bottom: 2px solid black; padding-bottom: 10px; margin-bottom: 20px; }
            .k1 { font-size: 14pt; font-weight: bold; text-transform: uppercase; }
            .k2 { font-size: 16pt; font-weight: bold; text-transform: uppercase; margin: 4px 0; }
            .k3 { font-size: 10pt; font-style: italic; }

            /* Tanda Tangan */
            .ttd-wrap { display: flex; justify-content: space-between; margin-top: 40px; page-break-inside: avoid; }
            .ttd-box { text-align: center; width: 40%; font-size: 11pt; }
            .ttd-nama { font-weight: bold; text-decoration: underline; margin-top: 70px; }
        }
    </style>
</head>
<body class="antialiased">

    <div id="loading" class="loader hidden">
        <div class="spin mb-3"></div>
        <p class="font-bold text-gray-600 animate-pulse">Memproses Data...</p>
    </div>

    <div id="modalView" class="modal-overlay hidden">
        <div class="modal-box">
            <div class="bg-brand-900 text-white p-4 flex justify-between items-center sticky top-0">
                <h3 class="font-bold text-lg"><i class="fas fa-file-alt mr-2"></i> Detail Jurnal</h3>
                <button onclick="closeModal()" class="w-8 h-8 rounded-full hover:bg-white/20 flex items-center justify-center"><i class="fas fa-times"></i></button>
            </div>
            <div class="p-6" id="modalContent"></div>
            <div class="bg-gray-100 p-4 text-right">
                <button onclick="closeModal()" class="bg-gray-500 text-white px-5 py-2 rounded-lg text-sm font-bold hover:bg-gray-600">Tutup</button>
            </div>
        </div>
    </div>

    <div id="pageLogin" class="min-h-screen flex items-center justify-center p-4 bg-gradient-to-br from-blue-50 to-blue-100">
        <div class="bg-white p-8 rounded-2xl shadow-xl w-full max-w-sm border border-white/50">
            <div class="text-center mb-6">
                <div class="bg-blue-600 w-16 h-16 rounded-2xl flex items-center justify-center mx-auto mb-4 text-white text-3xl shadow-lg shadow-blue-500/30">
                    <i class="fas fa-book-reader"></i>
                </div>
                <h2 class="text-2xl font-bold text-gray-800">JURNAL BK</h2>
                <p class="text-xs text-gray-500 uppercase tracking-widest mt-1">Mappaguru Online</p>
            </div>
            <form onsubmit="doLogin(event)" class="space-y-4">
                <div>
                    <label class="text-xs font-bold text-gray-500 ml-1">USERNAME</label>
                    <input id="u" type="text" class="w-full border-gray-200 bg-gray-50 p-3 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none transition" placeholder="NIP / User" required>
                </div>
                <div>
                    <label class="text-xs font-bold text-gray-500 ml-1">PASSWORD</label>
                    <input id="p" type="password" class="w-full border-gray-200 bg-gray-50 p-3 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none transition" placeholder="Kata Sandi" required>
                </div>
                <button class="w-full bg-blue-600 text-white font-bold py-3.5 rounded-xl hover:bg-blue-700 hover:shadow-lg transition transform hover:-translate-y-0.5">MASUK APLIKASI</button>
            </form>
            <div class="mt-8 text-center text-[10px] text-gray-400">
                Created by Muhammad Hasratul
            </div>
        </div>
    </div>

    <div id="pageMain" class="hidden min-h-screen bg-gray-50 flex flex-col">
        <header class="bg-white shadow-sm sticky top-0 z-40">
            <div class="max-w-5xl mx-auto flex justify-between items-center p-4">
                <div>
                    <div class="text-[10px] font-bold text-blue-600 uppercase tracking-wide" id="headerDate">SENIN, 1 JANUARI 2026</div>
                    <div class="font-bold text-lg text-gray-800 leading-tight truncate max-w-[200px] md:max-w-md" id="dSekolah">Loading...</div>
                    <div class="text-xs text-gray-500">Guru: <span id="dGuru" class="font-bold text-black"></span></div>
                </div>
                <button onclick="logout()" class="text-xs bg-red-50 text-red-600 border border-red-200 px-4 py-2 rounded-full hover:bg-red-600 hover:text-white font-bold transition flex items-center gap-2">
                    <i class="fas fa-power-off"></i> <span class="hidden md:inline">Keluar</span>
                </button>
            </div>
            <div class="max-w-5xl mx-auto flex border-t bg-white">
                <div onclick="switchTab('input')" id="tab1" class="tab-btn active"><i class="fas fa-edit mr-2"></i> INPUT</div>
                <div onclick="switchTab('history')" id="tab2" class="tab-btn"><i class="fas fa-list mr-2"></i> RIWAYAT</div>
            </div>
        </header>

        <div class="max-w-5xl mx-auto w-full px-4 py-6 flex-grow">
            
            <div id="viewInput">
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                    <div class="flex justify-between items-center mb-6 border-b pb-4">
                        <h3 class="font-bold text-xl text-gray-800" id="formTitle">Input Kegiatan</h3>
                        <button onclick="resetForm()" id="btnCancel" class="hidden text-red-500 text-xs font-bold uppercase border border-red-200 px-3 py-1 rounded hover:bg-red-50">Batal</button>
                    </div>

                    <form id="formJurnal" onsubmit="submitData(event)" class="space-y-5">
                        <input type="hidden" name="id" id="inputId">
                        
                        <div class="grid md:grid-cols-2 gap-5"> <div>
                                <label class="text-xs font-bold text-gray-500 block mb-1">TANGGAL KEGIATAN</label>
                                <input type="date" name="tanggal" required class="w-full border p-3 rounded-lg bg-blue-50 focus:bg-white focus:ring-2 focus:ring-blue-300 outline-none">
                            </div>
                            <div class="grid grid-cols-2 gap-3">
                                <div><label class="text-xs font-bold text-gray-500 block mb-1">JAM KE-</label><input type="text" name="jam" placeholder="1-2" class="w-full border p-3 rounded-lg"></div>
                                <div><label class="text-xs font-bold text-gray-500 block mb-1">DURASI</label><input type="text" name="waktu" placeholder="40 Mnt" class="w-full border p-3 rounded-lg"></div>
                            </div>
                        </div>

                        <div class="grid md:grid-cols-2 gap-5">
                            <div><label class="text-xs font-bold text-gray-500 block mb-1">SASARAN</label><input type="text" name="sasaran" placeholder="Siswa/Guru" required class="w-full border p-3 rounded-lg"></div>
                            <div><label class="text-xs font-bold text-gray-500 block mb-1">KELAS</label><input type="text" name="kelas" placeholder="Cth: IX A" class="w-full border p-3 rounded-lg"></div>
                        </div>

                        <div class="grid md:grid-cols-2 gap-5">
                            <div>
                                <label class="text-xs font-bold text-gray-500 block mb-1">BIDANG</label>
                                <select name="bidang" class="w-full border p-3 rounded-lg bg-white"><option>Pribadi</option><option>Sosial</option><option>Belajar</option><option>Karir</option></select>
                            </div>
                            <div>
                                <label class="text-xs font-bold text-gray-500 block mb-1">JENIS LAYANAN</label>
                                <input type="text" name="jenis" list="ls" class="w-full border p-3 rounded-lg" placeholder="Pilih/Ketik...">
                                <datalist id="ls"><option value="Konseling Individu"><option value="Bimbingan Kelompok"><option value="Bimbingan Klasikal"><option value="Konsultasi"></datalist>
                            </div>
                        </div>

                        <div><label class="text-xs font-bold text-gray-500 block mb-1">TOPIK / MASALAH</label><input type="text" name="topik" class="w-full border p-3 rounded-lg font-medium"></div>

                        <div class="grid md:grid-cols-2 gap-5">
                            <div><label class="text-xs font-bold text-gray-500 block mb-1">TUJUAN</label><textarea name="tujuan" rows="2" class="w-full border p-3 rounded-lg"></textarea></div>
                            <div><label class="text-xs font-bold text-gray-500 block mb-1">MEDIA / ALAT</label><input type="text" name="media" class="w-full border p-3 rounded-lg"></div>
                        </div>

                        <div><label class="text-xs font-bold text-gray-500 block mb-1">RINGKASAN PROSES</label><textarea name="ringkasan" rows="3" class="w-full border p-3 rounded-lg"></textarea></div>

                        <div class="grid md:grid-cols-3 gap-4 bg-gray-50 p-4 rounded-xl border">
                            <div><label class="text-[10px] font-bold text-gray-400 block mb-1">EVALUASI</label><textarea name="evaluasi" rows="2" class="w-full border p-2 rounded bg-white text-sm"></textarea></div>
                            <div><label class="text-[10px] font-bold text-gray-400 block mb-1">TINDAK LANJUT</label><textarea name="tindaklanjut" rows="2" class="w-full border p-2 rounded bg-white text-sm"></textarea></div>
                            <div><label class="text-[10px] font-bold text-gray-400 block mb-1">CATATAN KHUSUS</label><textarea name="catatan" rows="2" class="w-full border p-2 rounded bg-white text-sm"></textarea></div>
                        </div>

                        <button id="btnSimpan" class="w-full bg-blue-600 text-white font-bold py-4 rounded-xl shadow-lg hover:bg-blue-700 transition flex justify-center items-center gap-2">
                            <i class="fas fa-save"></i> SIMPAN JURNAL
                        </button>
                    </form>
                </div>
            </div>

            <div id="viewHistory" class="hidden">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-bold text-gray-700 text-lg">Data Tersimpan</h3>
                    <button onclick="loadHistory()" class="text-blue-600 text-sm font-bold bg-white px-3 py-1 rounded border hover:bg-blue-50"><i class="fas fa-sync"></i> Refresh</button>
                </div>
                <div id="listContainer" class="space-y-4"></div>
            </div>

        </div>

        <footer class="text-center text-xs text-gray-400 py-6 mt-auto border-t bg-white">
            <p>Pengembang: <b>Muhammad Hasratul</b> - Mappaguru Online &copy; 2026</p>
        </footer>
    </div>

    <div id="printArea" class="hidden">
        <div class="kop">
            <div class="k1" id="p_pem"></div>
            <div class="k1" id="p_ins"></div>
            <div class="k2" id="p_sek"></div>
            <div class="k3" id="p_almt"></div>
        </div>
        <div class="judul-pdf" id="p_judul" style="text-align:center; font-weight:bold; text-decoration:underline; font-size:12pt; margin-top:15px; text-transform:uppercase;">LAPORAN PELAKSANAAN LAYANAN BIMBINGAN DAN KONSELING</div>
        <div class="info-ta" style="text-align:center; font-size:11pt; font-weight:bold; margin-bottom:20px;">
            Tahun Pelajaran: <span id="p_ta"></span> | Semester: <span id="p_sem"></span>
        </div>

        <table class="tbl-pdf">
            <tr><td class="col-label">Hari, Tanggal</td><td id="t1"></td></tr>
            <tr><td class="col-label">Jam / Waktu</td><td><span id="t2"></span> / <span id="t3"></span></td></tr>
            <tr><td class="col-label">Sasaran (Kelas)</td><td><span id="t4"></span> (<span id="t5"></span>)</td></tr>
            <tr><td class="col-label">Bidang & Jenis</td><td><span id="t6"></span> - <span id="t7"></span></td></tr>
            <tr><td class="col-label">Topik / Masalah</td><td id="t8"></td></tr>
            <tr><td class="col-label">Tujuan Layanan</td><td id="t9"></td></tr>
            <tr><td class="col-label">Media / Alat</td><td id="t10"></td></tr>
            <tr><td class="col-label">Ringkasan Proses</td><td id="t11" style="min-height: 80px;"></td></tr>
            <tr><td class="col-label">Hasil Evaluasi</td><td id="t12"></td></tr>
            <tr><td class="col-label">Tindak Lanjut</td><td id="t13"></td></tr>
            <tr><td class="col-label">Catatan Khusus</td><td id="t14"></td></tr>
        </table>

        <div class="ttd-wrap">
            <div class="ttd-box">
                <p>Mengetahui,<br>Kepala Sekolah</p>
                <div class="ttd-nama" id="pkep"></div>
                <p>NIP. <span id="pnipkep"></span></p>
            </div>
            <div class="ttd-box">
                <p>Makassar, <span id="ptglttd"></span><br>Guru BK</p>
                <div class="ttd-nama" id="pguru"></div>
                <p>NIP. <span id="pnipguru"></span></p>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // PASTE URL APPS SCRIPT DI SINI
        // ============================================
        const API_URL = "https://script.google.com/macros/s/AKfycbxMbp7LlrCgbwoAIB_xCtrHCTpRI9s2zKT7BhH7E-d2qOnP2O8AzO4vxjl-EsaDMTwGog/exec"; 

        let user=null, conf=null, historyData=[];

        // Set Tanggal Header Otomatis
        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        document.getElementById('headerDate').innerText = new Date().toLocaleDateString('id-ID', options).toUpperCase();

        function switchTab(t){
            document.getElementById('viewInput').classList.add('hidden');
            document.getElementById('viewHistory').classList.add('hidden');
            document.getElementById('tab1').classList.remove('active');
            document.getElementById('tab2').classList.remove('active');
            if(t=='input'){
                document.getElementById('viewInput').classList.remove('hidden');
                document.getElementById('tab1').classList.add('active');
            } else {
                document.getElementById('viewHistory').classList.remove('hidden');
                document.getElementById('tab2').classList.add('active');
                loadHistory();
            }
        }

        async function doLogin(e){
            e.preventDefault(); loading(true);
            try {
                let u=document.getElementById('u').value, p=document.getElementById('p').value;
                let r=await fetch(`${API_URL}?action=login&u=${u}&p=${p}`).then(x=>x.json());
                if(r.status=='sukses'){
                    user=r;
                    conf=await fetch(`${API_URL}?action=getConfig`).then(x=>x.json());
                    document.getElementById('pageLogin').classList.add('hidden');
                    document.getElementById('pageMain').classList.remove('hidden');
                    document.getElementById('dSekolah').innerText=conf.sekolah;
                    document.getElementById('dGuru').innerText=user.nama;
                    
                    // POPUP SELAMAT DATANG
                    Swal.fire({
                        icon: 'success',
                        title: 'Selamat Datang!',
                        text: `Halo, ${user.nama}. Selamat bekerja!`,
                        timer: 2000,
                        showConfirmButton: false
                    });
                    
                    switchTab('input');
                } else {
                    Swal.fire('Login Gagal', r.message, 'error');
                }
            } catch(e){
                Swal.fire('Error', "Gagal Koneksi ke Server", 'error');
            }
            loading(false);
        }

        async function submitData(e){
            e.preventDefault();
            
            // Konfirmasi Simpan SweetAlert
            const result = await Swal.fire({
                title: 'Simpan Jurnal?',
                text: "Pastikan data sudah benar",
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Ya, Simpan!',
                cancelButtonText: 'Batal'
            });

            if (!result.isConfirmed) return;

            loading(true);
            let fd = new FormData(document.getElementById('formJurnal'));
            let d = Object.fromEntries(fd.entries());
            d.action="simpan"; d.namaGuru=user.nama; d.nipGuru=user.nip; 
            d.alamatGuru=user.alamat; d.ta=conf.ta; d.semester=conf.semester;

            try {
                await fetch(API_URL, {method:'POST', body:JSON.stringify(d)});
                Swal.fire('Berhasil!', 'Data jurnal telah disimpan.', 'success');
                resetForm();
                switchTab('history');
            } catch(x){
                Swal.fire('Gagal', 'Terjadi kesalahan saat menyimpan.', 'error');
            }
            loading(false);
        }

        async function loadHistory(){
            try {
                let r=await fetch(`${API_URL}?action=getHistory&nip=${user.nip}`).then(x=>x.json());
                historyData=r.data;
                let h="";
                if(historyData.length==0) h=`<div class="text-center p-8 bg-white border rounded-xl text-gray-400">Belum ada data jurnal.</div>`;
                
                historyData.forEach((d,i)=>{
                    h+=`
                    <div class="bg-white p-5 rounded-xl border border-gray-100 shadow-sm hover:shadow-md transition">
                        <div class="flex flex-col md:flex-row justify-between mb-3 gap-2">
                            <div>
                                <div class="font-bold text-lg text-gray-800">${d.topik}</div>
                                <div class="text-xs text-blue-600 font-bold bg-blue-50 inline-block px-2 py-0.5 rounded mt-1">${d.jenis}</div>
                            </div>
                            <div class="text-left md:text-right">
                                <div class="text-sm font-bold text-gray-500"><i class="far fa-calendar-alt mr-1"></i> ${d.tanggal.substring(0,10)}</div>
                                <div class="text-xs text-gray-400">Jam: ${d.jam}</div>
                            </div>
                        </div>
                        <div class="text-sm text-gray-600 mb-4 border-l-4 border-gray-200 pl-3">
                             Sasaran: <b>${d.sasaran}</b> | Kelas: <b>${d.kelas}</b>
                        </div>
                        <div class="grid grid-cols-4 gap-2 pt-2 border-t">
                            <button onclick="viewItem(${i})" class="bg-gray-100 text-gray-600 py-2 rounded text-xs font-bold hover:bg-gray-200"><i class="fas fa-eye"></i> <span class="hidden md:inline">LIHAT</span></button>
                            <button onclick="editItem(${i})" class="bg-yellow-50 text-yellow-600 py-2 rounded text-xs font-bold hover:bg-yellow-100"><i class="fas fa-edit"></i> <span class="hidden md:inline">EDIT</span></button>
                            <button onclick="printItem(${i})" class="bg-green-50 text-green-600 py-2 rounded text-xs font-bold hover:bg-green-100"><i class="fas fa-print"></i> <span class="hidden md:inline">PDF</span></button>
                            <button onclick="deleteItem('${d.id}')" class="bg-red-50 text-red-500 py-2 rounded text-xs font-bold hover:bg-red-100"><i class="fas fa-trash"></i> <span class="hidden md:inline">HAPUS</span></button>
                        </div>
                    </div>`;
                });
                document.getElementById('listContainer').innerHTML=h;
            } catch(e){}
        }

        function viewItem(i){
            let d=historyData[i];
            let html=`
                <table class="w-full text-sm border-collapse">
                    <tr><td class="font-bold py-2 w-1/3 text-gray-500">Tanggal</td><td>: ${d.tanggal.substring(0,10)}</td></tr>
                    <tr><td class="font-bold py-2 text-gray-500">Waktu</td><td>: ${d.jam} (${d.waktu})</td></tr>
                    <tr><td class="font-bold py-2 text-gray-500">Sasaran</td><td>: ${d.sasaran} (${d.kelas})</td></tr>
                    <tr><td class="font-bold py-2 text-gray-500">Layanan</td><td>: ${d.jenis}</td></tr>
                    <tr><td colspan="2" class="pt-4"><div class="font-bold text-blue-900 mb-1">Topik Masalah</div><div class="bg-gray-50 p-2 rounded border">${d.topik}</div></td></tr>
                    <tr><td colspan="2" class="pt-2"><div class="font-bold text-blue-900 mb-1">Ringkasan</div><div class="bg-gray-50 p-2 rounded border">${d.ringkasan}</div></td></tr>
                </table>`;
            document.getElementById('modalContent').innerHTML=html;
            document.getElementById('modalView').classList.remove('hidden');
        }
        function closeModal(){document.getElementById('modalView').classList.add('hidden');}

        function editItem(i){
            let d=historyData[i];
            switchTab('input');
            document.getElementById('inputId').value=d.id;
            let f=document.getElementById('formJurnal');
            f.tanggal.value=d.tanggal.substring(0,10); f.jam.value=d.jam; f.waktu.value=d.waktu;
            f.sasaran.value=d.sasaran; f.kelas.value=d.kelas; f.bidang.value=d.bidang; f.jenis.value=d.jenis;
            f.topik.value=d.topik; f.tujuan.value=d.tujuan; f.media.value=d.media;
            f.ringkasan.value=d.ringkasan; f.evaluasi.value=d.evaluasi;
            f.tindaklanjut.value=d.tindaklanjut; f.catatan.value=d.catatan;
            
            document.getElementById('formTitle').innerText="Edit Jurnal";
            document.getElementById('btnSimpan').innerHTML="<i class='fas fa-sync'></i> UPDATE DATA";
            document.getElementById('btnSimpan').classList.replace('bg-blue-600','bg-orange-500');
            document.getElementById('btnCancel').classList.remove('hidden');
            window.scrollTo(0,0);
        }

        function resetForm(){
            document.getElementById('formJurnal').reset();
            document.getElementById('inputId').value="";
            document.getElementById('formTitle').innerText="Input Kegiatan";
            document.getElementById('btnSimpan').innerHTML="<i class='fas fa-save'></i> SIMPAN JURNAL";
            document.getElementById('btnSimpan').classList.replace('bg-orange-500','bg-blue-600');
            document.getElementById('btnCancel').classList.add('hidden');
        }

        async function deleteItem(id){
            // Konfirmasi Hapus SweetAlert
            const result = await Swal.fire({
                title: 'Yakin hapus data?',
                text: "Data tidak bisa dikembalikan!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: 'Ya, Hapus!'
            });

            if(!result.isConfirmed) return;

            loading(true);
            try {
                await fetch(API_URL, {method:'POST', body:JSON.stringify({action:'hapus',id:id})});
                Swal.fire('Terhapus!', 'Data berhasil dihapus.', 'success');
                loadHistory();
            } catch(e){Swal.fire('Gagal', 'Gagal menghapus data.', 'error');}
            loading(false);
        }

        function printItem(i){
            let d=historyData[i];
            document.getElementById('p_pem').innerText=conf.pem;
            document.getElementById('p_ins').innerText=conf.instansi;
            document.getElementById('p_sek').innerText=conf.sekolah;
            document.getElementById('p_almt').innerText=conf.alamat;
            document.getElementById('p_ta').innerText=conf.ta;
            document.getElementById('p_sem').innerText=conf.semester;

            document.getElementById('t1').innerText=d.tanggal.substring(0,10);
            document.getElementById('t2').innerText=d.jam; document.getElementById('t3').innerText=d.waktu;
            document.getElementById('t4').innerText=d.sasaran; document.getElementById('t5').innerText=d.kelas;
            document.getElementById('t6').innerText=d.bidang; document.getElementById('t7').innerText=d.jenis;
            document.getElementById('t8').innerText=d.topik; document.getElementById('t9').innerText=d.tujuan;
            document.getElementById('t10').innerText=d.media; document.getElementById('t11').innerText=d.ringkasan;
            document.getElementById('t12').innerText=d.evaluasi; document.getElementById('t13').innerText=d.tindaklanjut;
            document.getElementById('t14').innerText=d.catatan;

            document.getElementById('pkep').innerText=conf.kepsek; document.getElementById('pnipkep').innerText=conf.nip_kepsek;
            document.getElementById('pguru').innerText=user.nama; document.getElementById('pnipguru').innerText=user.nip;
            document.getElementById('ptglttd').innerText=d.tanggal.substring(0,10);

            window.print();
        }

        function logout(){
            Swal.fire({
                title: 'Keluar Aplikasi?',
                text: "Sesi Anda akan diakhiri.",
                icon: 'question',
                showCancelButton: true,
                confirmButtonText: 'Ya, Keluar'
            }).then((result) => {
                if (result.isConfirmed) {
                    Swal.fire('Sampai Jumpa!','','success').then(()=>location.reload());
                }
            });
        }
        
        function loading(x){document.getElementById('loading').classList.toggle('hidden',!x);}
    </script>
</body>
</html>
